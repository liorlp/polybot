{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.messages[0].text.body }}",
        "options": {
          "systemMessage": "=You are “PoliBot,” the friendly chat assistant for people who like to understand if they have coverage with their health insurace. \n\nYour role is to answer user's question regarding specific coverage only on doucments in the supabase KB\n\nClearly explain:\n\n1) Whether a specific coverage exists (e.g., physiotherapy, dental, mental health).\n\n2) What the coverage includes and the reimbursement limits (e.g., up to 80%, up to 300 NIS per session, up to 10 sessions per year).\n\n3) What conditions or documents are required to receive reimbursement (e.g., doctor referral, original receipt).\n\nBehavior rules:\n\n1) Use simple, friendly language. Avoid legal or technical jargon. write only in hebrew, While responding you can use emoji's etc to make the conversation more user friendly.\n\n2) Be concise but complete. Prioritize clarity over formality.\n\n3) If the user asks about a service not covered, say so clearly and try to ask him to provide his number so we can suggest him a different health insurance policy.\n\n4) If the information is unavailable, let the user know and suggest next steps (e.g., contact the insurer directly).\n\n5) You do not invent or guess coverage details. Only respond based on the supbase database.\n   \n"
        }
      },
      "id": "a085d258-0176-49ca-ac1c-c0503eef60c1",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        640,
        -240
      ],
      "typeVersion": 1.8
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o",
          "mode": "list",
          "cachedResultName": "gpt-4o"
        },
        "options": {}
      },
      "id": "1c5ae9c6-e89d-430a-996f-8e1ca3c8f8c3",
      "name": "OpenAI 4o",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        460,
        60
      ],
      "typeVersion": 1.2,
      "credentials": {
        "openAiApi": {
          "id": "3TVa7eFqDyPshN72",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "smilecraft_knowledge_base",
        "toolDescription": "Finds information from smilecraft dental clinic",
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.1,
      "position": [
        980,
        40
      ],
      "id": "38858ec4-108b-49d9-b172-5c4ed6650689",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "wiXHuSk4NsvKZqp8",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        980,
        220
      ],
      "id": "d52ca955-b05d-47b1-9957-cd76258052c5",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "3TVa7eFqDyPshN72",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "={{ $('WhatsApp Trigger').item.json.metadata.phone_number_id }}",
        "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}",
        "textBody": "={{ $json.output }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        1040,
        -240
      ],
      "id": "99e973ac-f74d-4e34-ae8a-1913cd568329",
      "name": "WhatsApp Business Cloud",
      "webhookId": "9640f856-2010-4b34-b04f-a37d2f9f6328",
      "credentials": {
        "whatsAppApi": {
          "id": "LBTeIduVLxvhHfVn",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "updates": [
          "messages"
        ],
        "options": {}
      },
      "type": "n8n-nodes-base.whatsAppTrigger",
      "typeVersion": 1,
      "position": [
        440,
        -240
      ],
      "id": "76aba360-74c1-4682-8732-1ec19eec2d1b",
      "name": "WhatsApp Trigger",
      "webhookId": "c0402e6f-f0b8-43be-aa28-4fb2587d1f2b",
      "credentials": {
        "whatsAppTriggerApi": {
          "id": "XzVFC5rUETEg1NNg",
          "name": "WhatsApp OAuth account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('WhatsApp Trigger').item.json.contacts[0].wa_id}}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        620,
        60
      ],
      "id": "3955d8d3-a381-482b-8524-489d5814e5ad",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "qNWkV2HBAVF2D7QO",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "content": "AI Agent + MCP Client which calls MCP Server for Appointment booking",
        "height": 660,
        "width": 960,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        340,
        -320
      ],
      "id": "f7a1727f-705c-4a54-901f-8b89f848c573",
      "name": "Sticky Note1"
    }
  ],
  "pinData": {},
  "connections": {
    "OpenAI 4o": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "WhatsApp Business Cloud",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "4abd1d34-25b5-4053-ba17-fa2625b84e22",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "5a3a47136c4edc81454a2a30e6669a99de0b196292d4fc55416410c8a194ad7a"
  },
  "id": "AgYn8LpnU3yltPna",
  "tags": []
}